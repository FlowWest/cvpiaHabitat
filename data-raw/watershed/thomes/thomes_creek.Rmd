---
title: "Thomes Creek"
author: "[Sadie Gill](mailto:sgill@flowwest.com), [Mark Tompkins](mailto:mtompkins@flowwest.com), [Erin Cain](mailto:ecain@flowwest.com)"
date: "July 17, 2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)
knitr::opts_knit$set(root.dir = rprojroot::find_rstudio_root_file())
library(tidyverse)
library(readxl)
library(cvpiaHabitat)
```

## Future Data Improvements
None Planned 

## Instream Spawning and Rearing Habiat
```{r}
source('data-raw/watershed/mean_wua_description.R')
```
**Data Source:** 
`r print_mean_wua_details('Thomes Creek')`

### Combine Spawning and Rearing Data 
The instream spawning and rearing habitat data described above for Fall Run Chinook Salmon (FR) is combined for use in the DSM in the following format.

```{r}
mean_wua <- upper_mid_sac_region_instream %>% 
  mutate(watershed = 'Thomes Creek')

knitr::kable(align = 'c', head(mean_wua, 5))
```

### Spawning WUA 
The instream spawning habitat weighted usable areas for Fall Run Chinook Salmon in the Thomes Creek.

#### Spawning WUA Plot
The following plot shows the weighted usable spawning area in square feet per thousand feet of river for Fall Run Chinook Salmon. These area per length rates are multiplied by the total spawning reach length mapped by the SIT. 

```{r, echo=FALSE}
mean_wua %>%
  filter(!is.na(FR_spawn_wua)) %>%
  ggplot(aes(flow_cfs, FR_spawn_wua)) +
  geom_line(color = '#7570b3' ) +
  labs(x = 'Flow (cfs)', y = 'WUA (sqft/1000ft)') +
  theme_minimal() 
```

### Rearing WUA
The fry and juvenile instream rearing habitat weighted usable areas for Fall Run Chinook Salmon in Thomes Creek. 

#### Rearing WUA Plot

The following plot shows the weighted usable rearing area in square feet per thousand feet of river for Fall Run Chinook Salmon fry and juvenile. These rates are multiplied by the total rearing reach length mapped by the SIT. 

``` {r,echo=FALSE}
mean_wua %>% 
  gather(lifestage, wua, -flow_cfs, -watershed)  %>% 
  filter(!is.na(wua), lifestage != 'FR_spawn_wua', lifestage != "ST_fry_wua", lifestage != "ST_juv_wua") %>%
  mutate(lifestage = ifelse(lifestage == 'FR_fry_wua', 'fry', 'juvenile')) %>% 
  ggplot(aes(x = flow_cfs , y = wua, color = lifestage)) +
  geom_line() +
  labs(x = 'flow (cfs)', y = 'WUA (sqft/1000ft)') + theme_minimal() +
  scale_color_manual(values = c('#d95f02','#7570b3'))
```


```{r}
source('data-raw/floodplain/floodplain_utils.R')
```

## Floodplain Modeling Details

**Data Source:** 

[Scaled USFWS / FEMA 1D HEC-RAS hydraulic model](https://s3-us-west-2.amazonaws.com/cvpiahabitat-r-package/cvpia-sit-model-inputs/CVPIA+Annual+Progress+Report+Fiscal+Year+2017.pdf)

### Fall Run
`r print_model_details('Thomes Creek', 'fr')`

### Spring Run and Steelhead
`r print_model_details('Thomes Creek', 'sr')`

## Floodplain Data

```{r}
# TODO Ask mark about the difference in outcome from his sheet
thomes_creek_floodplain <- scale_fp_flow_area('Thomes Creek')

knitr::kable(align = 'c', head(thomes_creek_floodplain, 5)) 
# devtools::use_data(thomes_creek_floodplain, overwrite = TRUE)
```

*...with 5 more rows*

## Floodplain Plot
```{r}
thomes_creek_floodplain %>% 
  select(FR_floodplain_acres, SR_floodplain_acres, watershed, flow_cfs) %>%
  rename(`Fall Run Chinook` = FR_floodplain_acres, `Spring Run Chinook and Steelhead` = SR_floodplain_acres) %>% 
  gather(Species, acres, -flow_cfs, -watershed) %>% 
  ggplot(aes(flow_cfs, acres, color = Species)) +
  geom_line() +
  theme_minimal() +
  scale_color_brewer(palette = 'Dark2') +
  labs(x = 'Flow (cfs)', y = 'Total Inundated Acres')
```
