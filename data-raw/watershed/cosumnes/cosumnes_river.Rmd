---
title: "Cosumnes River"
author: "[Sadie Gill](mailto:sgill@flowwest.com), [Mark Tompkins](mailto:mtompkins@flowwest.com), [Erin Cain](ecain@flowwest.com)"
date: "August 15, 2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, out.width = '100%')
knitr::opts_knit$set(root.dir = rprojroot::find_rstudio_root_file())
library(tidyverse)
library(readxl)
library(cvpiaHabitat)
library(scales)

```
## Future Data Improvements
None Planned 

## Instream Spawning and Rearing Habitat

**Data Source:** [Calaveras, FISHBIO Environmental and Thomas R. Payne & Associates 2009](https://s3-us-west-2.amazonaws.com/cvpiahabitat-r-package/cvpia-sit-model-inputs/FishBio_Payne2009_CalaverasInstreamFlowStudy.pdf) and [Mokelumne, CDFW 1991](https://s3-us-west-2.amazonaws.com/cvpiahabitat-r-package/cvpia-sit-model-inputs/Lower+Mokelumne+RIver+Fisheries+Management+Plan%2C+CDFG+1991.pdf)

No watershed specific salmonid habitat data was available for the Consumnes River. A regional weighted usable area (WUA) relationship with flow was derived for the Consumnes River by averaging the WUA values on the Calaveras River and the Mokelumne River. The geomorphic and hydrologic conditions in Consumnes River (watershed area = 2124 sqkm; active channel width = 27.25 meters) are similar to those on Calaveras River (watershed area = 1369 sqkm; active channel width = 10.2), Mokelumne River (watershed area = 3070 sqkm; active channel width = 10.4 m). The regional WUA relationships for Consumnes River were multiplied by the length of spawning and rearing extents mapped by the Science Integration Team (SIT).  

### Combine Spawning and Rearing Data 
The instream spawning and rearing habitat data described above for Fall Run Chinook Salmon (FR) is combined for use in the DSM in the following format. Units are in square feet per 1000 feet.
```{r,echo=FALSE}
 #cosumnes -----
 region <- cvpiaHabitat::modeling_exist %>%
   filter(Region == 'South Delta') %>%
   select(Watershed, Region, FR_fry, FR_juv)
 
 flows <- seq(100, 1000, by = 100)
 
 #spawn
 cal_st_spwn <- approx(calaveras_river_instream$flow_cfs, 
                       calaveras_river_instream$ST_spawn_wua, 
                       rule = 2, xout = flows)$y

 mok_fr_spwn <- approx(mokelumne_river_instream$flow_cfs, 
                       mokelumne_river_instream$FR_spawn_wua, 
                       rule = 2, xout = flows)$y
 
 cos_spwn <- (cal_st_spwn + mok_fr_spwn) / 2
 
 # fry
 cal_st_fry <- approx(calaveras_river_instream$flow_cfs, 
                       calaveras_river_instream$ST_fry_wua, 
                       rule = 2, xout = flows)$y
 
 mok_fr_fry <- approx(mokelumne_river_instream$flow_cfs, 
                       mokelumne_river_instream$FR_fry_wua, 
                       rule = 2, xout = flows)$y
 
 cos_fry <- (cal_st_fry + mok_fr_fry) / 2
 
 # juv
 cal_st_juv <- approx(calaveras_river_instream$flow_cfs, 
                       calaveras_river_instream$ST_juv_wua, 
                       rule = 2, xout = flows)$y
 
 mok_fr_juv <- approx(mokelumne_river_instream$flow_cfs, 
                       mokelumne_river_instream$FR_juv_wua, 
                       rule = 2, xout = flows)$y
 
 cos_juv <- (cal_st_juv + mok_fr_juv) / 2
 
 
 
 cosumnes_river_instream <- tibble(flow_cfs = flows, FR_spawn_wua = cos_spwn, 
                                   FR_fry_wua = cos_fry, FR_juv_wua = cos_juv,
                                   watershed = 'Cosumnes River')
 
knitr::kable(align = 'c', head(cosumnes_river_instream, 5), caption = 
                                  "Header Descriptions: flow_cfs = flow in cubic feet per second, FR_spawn_wua = Fall Run Chinook Spawning wua, FR_juv_wua = Fall Run Chinook Juvenile wua, FR_fry_wua = Fall Run Chinook Fry wua")
# usethis::use_data(cosumnes_river_instream, overwrite = TRUE)
```

*...with 5 more rows.* 

### Spawning WUA 
The following plot shows the weighted usable spawning area in square feet per thousand feet of river for Fall Run Chinook Salmon. These area per length rates are multiplied by the total spawning reach length mapped by the SIT. 
``` {r,echo=FALSE}
cosumnes_river_instream %>% 
    filter(!is.na(FR_spawn_wua)) %>%
    ggplot(aes(x = flow_cfs , y = FR_spawn_wua)) +
    geom_line(color= '#7570b3') +
    labs(x = 'Flow (cfs)', y = 'WUA (sqft/1000ft)') + 
    theme_minimal()
```

### Rearing WUA
The following plot shows the weighted usable rearing area in square feet per thousand feet of river for Fall Run Chinook Salmon fry and juvenile. These rates are multiplied by the total rearing reach length mapped by the SIT. 
``` {r,echo=FALSE}
cosumnes_river_instream %>% 
  gather(Lifestage, wua, -flow_cfs, -watershed)  %>% 
  filter(!is.na(wua), Lifestage != 'FR_spawn_wua') %>%
  mutate(Lifestage = ifelse(Lifestage == 'FR_fry_wua', 'Fry', 'Juvenile')) %>% 
  ggplot(aes(x = flow_cfs , y = wua, color = Lifestage)) +
  geom_line() +
  labs(x = 'Flow (cfs)', y = 'WUA (sqft/1000ft)') + 
  theme_minimal() + 
  scale_color_manual(values = c('#d95f02','#7570b3')) +
  theme(legend.justification = c(1,0), legend.position = c(.9,.7))
```

```{r, include = FALSE}
source('data-raw/floodplain/floodplain_utils.R')
```

## Floodplain Rearing Habitat 

**Data Source:** [Mark Gard](mailto:mark_gard@fws.gov)

Mark Gard developed a flow-floodplain area relationship for the Cosumnes based on a UC Davis 1-D HEC-RAS model. 

## Floodplain Data
```{r, echo=FALSE}
floodplain <- read_excel('data-raw/mark_gard_data/Floodplainarea.xlsx', 
                         range = "B2:E37", sheet = "Cosumnes") %>%
  rename(flow_cfs = cfs, FR_floodplain_acres = "floodplain area acres") 


cosumnes_river_floodplain <- floodplain %>%
  mutate(watershed = "Consumnes") %>%
  select(flow_cfs, FR_floodplain_acres, watershed) %>% 
  filter(flow_cfs > 1000)

knitr::kable(align = 'c', head(cosumnes_river_floodplain, 5), caption = "Header Descriptions: flow_cfs = flow in cubic feet per second, FR_floodplain_acres = Fall Run Chinook Floodplain Acres")
# usethis::use_data(cosumnes_river_floodplain, overwrite = TRUE)
```

*...with 28 more rows*

## Floodplain Plot
```{r, echo = FALSE}
cosumnes_river_floodplain %>% 
  select(FR_floodplain_acres, flow_cfs, watershed) %>%
  rename(`Fall Run Chinook` = FR_floodplain_acres) %>% 
  gather(Species, acres, -flow_cfs, -watershed) %>% 
  ggplot(aes(flow_cfs, acres, color = Species)) +
  geom_line() +
  theme_minimal() +
  scale_color_brewer(palette = 'Dark2') +
  labs(x = 'Flow (cfs)', y = 'Total Inundated Acres') +
  theme(legend.justification = c(1,0), legend.position = c(.9,.1))
```
